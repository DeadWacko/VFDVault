# VFD Wi-Fi Clock

Описание реализации работы с флеш-памятью и настройками для VFD Wi-Fi часов на базе микроконтроллера RP2040.

## Основные возможности

- XOR-шифрование паролей Wi-Fi с использованием SETTINGS_MAGIC.
- Проверка целостности данных с использованием CRC32.
- Поддержка нескольких NTP-серверов и периодической синхронизации.

## Файлы и их функции

- `config.h`: Конфигурационные параметры по умолчанию (SSID, пароль Wi-Fi, NTP-сервер).
- `flash_utils.c/h`: Функции для работы с флеш-памятью (запись и очистка сектора).
- `logging.h`: Логирование действий и ошибок.
- `settings.c/h`: Структура и функции работы с настройками, включая загрузку, сохранение и проверку целостности.
- `vfd_clock_flash.c`: Тестирование работы с настройками и флеш-памятью. Содержит набор тестов, проверяющих:
  - Загрузку и сохранение настроек по умолчанию.
  - Обработку пограничных случаев и переполнения буферов.
  - Проверку данных на корректность (CRC32, магическое число и версия структуры).
  - Шифрование и дешифрование пароля Wi-Fi.

## Структура настроек

Структура `settings_t` содержит:
- Уникальный идентификатор и версию структуры.
- Данные Wi-Fi (SSID, пароль с возможным XOR-шифрованием).
- Настройки яркости и ночного режима.
- Флаги включения анимаций.
- Список NTP-серверов.
- Период синхронизации NTP.
- Контрольную сумму CRC32 для проверки целостности данных.

## Порядок работы

1. Настройки инициализируются по умолчанию (`settings_init_default`).
2. Настройки сохраняются в сектор флеш-памяти с предварительным XOR-шифрованием пароля (если включено).
3. Настройки загружаются с проверкой целостности (CRC32) и дешифровкой пароля (если требуется).

## Запуск тестов

Файл `vfd_clock_flash.c` содержит набор тестов, запускаемых автоматически:
- Проверка загрузки и сохранения настроек.
- Проверка работы с недопустимыми и поврежденными данными.
- Проверка устойчивости к переполнениям и некорректным входным данным.

## Лицензия

MIT © 2025

